
<h2>Information</h2>


<p id="notice"><%= notice %></p>

<p>
  <%= @event.event_type %> event
</p>

<p>
  <strong>Gestor:</strong>
  <%= User.where(id: @event.user_id).first.email %>
  <% if need_request?(@event) %>
  |
  <%= following_button(User.find(@event.user_id)) %>
  <% end %>
</p>

<p>
  <%= if @event.private; 'Private'
      else; 'Public'
      end %>
</p>

<p>
  <strong>Start Date:</strong>
  <%= @event.date_start %>
</p>

<p>
  <strong>End Date:</strong>
  <%= @event.date_end %>
</p>

<%= link_to 'Edit', edit_event_path(@event) if current_user && current_user.id == @event.user_id %>

<h2>Matches</h2>

<table>
  <style>

  </style>
  <thead>
    <tr>
      <th>Name</th>
      <th>Deadline</th>
      <th>Start</th>
      <th colspan="3"></th>
    </tr>
  </thead>
  <tbody>
    <% Match.where(event_id: @event.id).each do |match| %>
      <tr>
        <td><%= match.name %></td>
        <td><%= match.bet_date %></td>
        <td><%= match.match_date %></td>
        <td><%= link_to 'Show', match %></td>
        <td><%if match.state == 0 %>
              <%= link_to 'Edit', edit_match_path(match) if (current_user && current_user.id == @event.user_id) %>
            <% else %>
              This match has been closed.
            <% end %></td>
        <td><%= link_to 'Destroy', match, method: :delete, data: { confirm: 'Are you sure?' } if (current_user && current_user.id == @event.user_id) %></td>
      </tr>
      <tr>
        <th>Team Names</th>
        <th>Placings</th>
        <th>Participations ID</th>
        <% Participation.where(match_id: match.id).each do |participation| %>
          <% t = Team.where(id: participation.team_id).first %>
          <tr>
            <td><%= t.name %></td>
            <td><%= if participation.placing == -1; ''
            else participation.placing
            end %></td>
            <td><%= participation.id %></td>
          </tr>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>


<% if current_user && current_user.id == @event.user_id%>
  <br/>
  <strong>New Match:</strong>
  <%= render :partial => 'matches/form', event: @event %>
<% end %>

<% if @event.private && current_user && @event.user_id == current_user.id %>
  <h2>Invitations</h2>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Mail</th>
        <th>Status</th>
        <th colspan="3"></th>
      </tr>
    </thead>
    <tbody>
      <% Follow.where(follower_id: current_user.id).each do |foll| %>
        <% other_user = foll.followed %>
        <% back = Follow.where(follower_id: other_user.id, followed_id: current_user.id).first %>
        <% status = back ? 'Friends' : 'Following' %>
        <tr>
          <td><%= other_user.first_name %>
          <%= other_user.last_name %></td>
          <td><%= other_user.email %></td>
          <td><%= status %></td>
          <td><%= invite_button(other_user, @event) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

<% end %>

<% if current_user %>
  <br/>
  <%= button_to 'Download results', {:controller => 'eventresults', :action => "create", :event_id => @event.id}, :method => :post %>

<% end %>

<%= link_to 'Back', events_path %>
